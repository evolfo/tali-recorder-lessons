'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var CSSPackager = _interopDefault(require('parcel-bundler/src/packagers/CSSPackager'));
var PurgeCSS = _interopDefault(require('purgecss'));

class PurgeCSSPackager extends CSSPackager {
    async addAsset(asset) {
        if (this.options.minify) {
            const config = (await asset.parentBundle.entryAsset.getConfig(["purgecss.config.js"], { packageKey: "purgecss" }));
            if (config) {
                asset.generated.css = new PurgeCSS({
                    ...config,
                    css: [{ extension: "css", raw: asset.generated.css }]
                }).purge()[0].css;
            }
        }
        return super.addAsset(asset);
    }
}

module.exports = PurgeCSSPackager;
